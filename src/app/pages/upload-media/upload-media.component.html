<div class="upload-container p-4">
    <div class="grid">
        <div [class]="lastUploadedMedia ? 'col-12 md:col-8' : 'col-12'">
            <p-card header="Upload New Media">
                <div class="grid p-fluid">
                    <div class="col-12 md:col-6 field">
                        <label for="title">Title</label>
                        <input id="title" type="text" pInputText [(ngModel)]="title" placeholder="Enter title">
                    </div>
                    <div class="col-12 md:col-6 field">
                        <label for="mediaType">Media Type</label>
                        <p-dropdown [options]="mediaTypes" [(ngModel)]="mediaType" optionLabel="label"
                            placeholder="Select type"></p-dropdown>
                    </div>
                    <div class="col-12 md:col-6 field">
                        <label for="artist">Artist (Optional)</label>
                        <p-dropdown [options]="artists" [(ngModel)]="selectedArtist" optionLabel="name"
                            placeholder="Select artist" [showClear]="true" [filter]="true" filterBy="name">
                            <ng-template let-artist pTemplate="item">
                                <div class="flex align-items-center gap-2">
                                    <span>{{artist.name}}</span>
                                    <i *ngIf="artist.verified" class="pi pi-verified text-primary text-sm"></i>
                                    <small *ngIf="artist.genre" class="text-secondary ml-auto">{{artist.genre}}</small>
                                </div>
                            </ng-template>
                            <ng-template pTemplate="empty">
                                <div class="p-2 text-center text-secondary">
                                    No artists found.
                                </div>
                            </ng-template>
                        </p-dropdown>
                        <small *ngIf="!selectedArtist && artists.length === 0" class="mt-1 block">
                            Want to add an artist? <a routerLink="/artists" class="text-primary">Go to Artists page</a>
                        </small>
                    </div>
                    <div class="col-12 md:col-6 field">
                        <label for="album">Album (Optional)</label>
                        <p-dropdown [options]="albums" [(ngModel)]="selectedAlbum" optionLabel="name"
                            placeholder="Select album" [showClear]="true" [filter]="true" filterBy="name"
                            [style]="{'width': '100%'}">
                            <ng-template let-album pTemplate="item">
                                <div class="flex align-items-center gap-2">
                                    <i class="pi pi-book"></i>
                                    <span>{{album.name}}</span>
                                    <small *ngIf="album.description" class="text-secondary ml-auto">{{album.description}}</small>
                                </div>
                            </ng-template>
                            <ng-template pTemplate="empty">
                                <div class="p-2 text-center text-secondary">
                                    No albums found.
                                </div>
                            </ng-template>
                        </p-dropdown>
                        <small *ngIf="selectedAlbum" class="text-secondary mt-1 block">
                            Media will be added to "{{selectedAlbum.name}}" after upload
                        </small>
                        <small *ngIf="!selectedAlbum && albums.length === 0" class="mt-1 block">
                            Want to create an album? <a routerLink="/albums" class="text-primary">Go to Albums page</a>
                        </small>
                    </div>

                    <!-- Release Date -->
                    <div class="col-12 md:col-6 field">
                        <label for="releaseDate">Release Date (Optional)</label>
                        <p-calendar [(ngModel)]="releaseDate" [showIcon]="true" dateFormat="yy-mm-dd"
                            placeholder="Select release date" [showButtonBar]="true"
                            [style]="{'width': '100%'}" inputId="releaseDate">
                        </p-calendar>
                        <small class="text-secondary mt-1 block">The official release date of the song</small>
                    </div>

                    <!-- Sub-Artists (Featuring) -->
                    <div class="col-12 field">
                        <label for="subArtists">Featuring Artists (Optional)</label>
                        <p-multiSelect [options]="artists" [(ngModel)]="selectedSubArtists" optionLabel="name"
                            placeholder="Select featuring artists" [filter]="true" filterBy="name"
                            display="chip" [style]="{'width': '100%'}">
                            <ng-template let-artist pTemplate="item">
                                <div class="flex align-items-center gap-2">
                                    <span>{{artist.name}}</span>
                                    <i *ngIf="artist.verified" class="pi pi-verified text-primary text-sm"></i>
                                </div>
                            </ng-template>
                        </p-multiSelect>
                        <small class="text-secondary mt-1 block">Select artists featured in this song</small>
                    </div>

                    <!-- Credits Section -->
                    <div class="col-12">
                        <p-divider align="left">
                            <span class="text-secondary"><i class="pi pi-pencil mr-2"></i>Credits (Optional)</span>
                        </p-divider>
                    </div>
                    <div class="col-12 md:col-6 field">
                        <label for="composer">Composer</label>
                        <p-dropdown [options]="composers" [(ngModel)]="selectedComposer" optionLabel="name"
                            placeholder="Select Composer" [showClear]="true" [filter]="true" filterBy="name"
                            [style]="{'width': '100%'}" id="composer">
                        </p-dropdown>
                        <small class="text-secondary mt-1 block">
                            <a routerLink="/credits" class="text-primary">Manage Composers</a>
                        </small>
                    </div>
                    <div class="col-12 md:col-6 field">
                        <label for="lyricist">Lyricist</label>
                        <p-dropdown [options]="lyricists" [(ngModel)]="selectedLyricist" optionLabel="name"
                            placeholder="Select Lyricist" [showClear]="true" [filter]="true" filterBy="name"
                            [style]="{'width': '100%'}" id="lyricist">
                        </p-dropdown>
                        <small class="text-secondary mt-1 block">
                            <a routerLink="/credits" class="text-primary">Manage Lyricists</a>
                        </small>
                    </div>
                    <div class="col-12 md:col-6 field">
                        <label for="producer">Producer</label>
                        <p-dropdown [options]="producers" [(ngModel)]="selectedProducer" optionLabel="name"
                            placeholder="Select Producer" [showClear]="true" [filter]="true" filterBy="name"
                            [style]="{'width': '100%'}" id="producer">
                        </p-dropdown>
                        <small class="text-secondary mt-1 block">
                            <a routerLink="/credits" class="text-primary">Manage Producers</a>
                        </small>
                    </div>
                    <div class="col-12 md:col-6 field">
                        <label for="director">Director</label>
                        <p-dropdown [options]="directors" [(ngModel)]="selectedDirector" optionLabel="name"
                            placeholder="Select Director" [showClear]="true" [filter]="true" filterBy="name"
                            [style]="{'width': '100%'}" id="director">
                        </p-dropdown>
                        <small class="text-secondary mt-1 block">
                            <a routerLink="/credits" class="text-primary">Manage Directors</a>
                        </small>
                    </div>

                    <div class="col-12">
                        <p-divider align="left">
                            <span class="text-secondary"><i class="pi pi-file mr-2"></i>Media Files</span>
                        </p-divider>
                    </div>
                    <div class="col-12 field">
                        <label for="description">Description</label>
                        <textarea id="description" rows="3" pInputTextarea [(ngModel)]="description"
                            placeholder="Enter description"></textarea>
                    </div>

                    <div class="col-12 md:col-6 field">
                        <label>Source File (Video/Audio)</label>
                        <p-fileUpload mode="basic" name="file" (onSelect)="onFileSelect($event, 'file')"
                            accept=".mp4,.mp3,.wav" [maxFileSize]="5000000000"
                            chooseLabel="Choose Source"></p-fileUpload>
                        <small class="text-secondary block mt-1">Supported: MP4 (video), MP3/WAV (audio). Max 5GB.</small>
                        <div *ngIf="file" class="mt-2 text-sm text-gray-500">Selected: {{file.name}}</div>
                    </div>

                    <div class="col-12 md:col-6 field">
                        <label>Thumbnail (Optional)</label>
                        <p-fileUpload mode="basic" name="thumbnail" (onSelect)="onFileSelect($event, 'thumbnail')"
                            accept="image/*" chooseLabel="Choose Thumbnail"></p-fileUpload>
                        <div *ngIf="thumbnail" class="mt-2 text-sm text-gray-500">Selected: {{thumbnail.name}}</div>
                    </div>

                    <div class="col-12 md:col-6 field">
                        <label>Lyrics (Optional)</label>
                        <p-fileUpload mode="basic" name="lyrics" (onSelect)="onFileSelect($event, 'lyrics')"
                            accept=".srt,.vtt" chooseLabel="Choose Lyrics"></p-fileUpload>
                        <div *ngIf="lyrics" class="mt-2 text-sm text-gray-500">Selected: {{lyrics.name}}</div>
                    </div>

                    <div class="col-12 mt-4">
                        <button pButton label="Upload Media" icon="pi pi-upload" [loading]="loading"
                            (click)="upload()"></button>
                    </div>
                </div>
            </p-card>
        </div>

        <div class="col-12 md:col-4" *ngIf="lastUploadedMedia">
            <p-card header="Recently Uploaded" styleClass="h-full">
                <div class="text-center">
                    <div class="success-icon mb-4">
                        <i class="pi pi-check-circle text-6xl text-success"></i>
                    </div>
                    <div class="text-xl font-bold mb-2">{{lastUploadedMedia.title}}</div>
                    <p class="text-secondary mb-4">Your media is being processed. It will be available for preview in
                        the Media List shortly.</p>

                    <div class="flex flex-column gap-2">
                        <a routerLink="/media-list" pButton label="Go to Media List" icon="pi pi-list"
                            class="p-button-outlined"></a>
                        <button pButton label="Dismiss" (click)="lastUploadedMedia = null"
                            class="p-button-text"></button>
                    </div>
                </div>
            </p-card>
        </div>
    </div>
</div>

<p-toast></p-toast>


