<div class="artist-container">
  <div class="artist-header">
    <h1><i class="pi pi-star"></i> Artist Management</h1>
    <p class="subtitle">Manage artists, their profiles, and verify their accounts</p>
  </div>

  <div class="artist-content">
    <!-- Artists List Panel -->
    <div class="artists-panel">
      <div class="panel-header">
        <h3>Artists</h3>
        <p-button icon="pi pi-plus" label="New Artist" (onClick)="openNewArtist()" styleClass="p-button-sm"></p-button>
      </div>

      <div class="search-bar mb-3">
        <span class="p-input-icon-left w-full">
          <i class="pi pi-search"></i>
          <input type="text" pInputText placeholder="Search artists..." [(ngModel)]="searchQuery"
                 (input)="onSearch()" class="w-full" />
        </span>
      </div>

      <div class="artists-list" *ngIf="artists.length > 0">
        <div
          *ngFor="let artist of artists"
          class="artist-card"
          [class.selected]="selectedArtist?.id === artist.id"
          (click)="selectArtist(artist)">
          <div class="artist-avatar">
            <img *ngIf="artist.imageUrl" [src]="artist.imageUrl" [alt]="artist.name" />
            <i *ngIf="!artist.imageUrl" class="pi pi-user"></i>
          </div>
          <div class="artist-info">
            <div class="artist-name">
              {{ artist.name }}
              <i *ngIf="artist.verified" class="pi pi-verified text-primary"></i>
            </div>
            <div class="artist-meta">{{ artist.genre || 'No genre' }} • {{ formatNumber(artist.monthlyListeners) }} listeners</div>
            <div class="text-tooltip" *ngIf="artist.name && artist.name.length > 20">
              <div class="tooltip-title">{{ artist.name }}</div>
              <div class="tooltip-desc">{{ artist.genre || 'No genre' }} • {{ formatNumber(artist.monthlyListeners) }} monthly listeners</div>
            </div>
          </div>
          <div class="artist-actions">
            <button pButton icon="pi pi-pencil" class="p-button-text p-button-sm" (click)="editArtist(artist); $event.stopPropagation()"></button>
            <button pButton icon="pi pi-trash" class="p-button-text p-button-danger p-button-sm" (click)="confirmDelete(artist); $event.stopPropagation()"></button>
          </div>
        </div>
      </div>

      <p-paginator *ngIf="totalRecords > rows" [rows]="rows" [totalRecords]="totalRecords"
                   (onPageChange)="onPageChange($event)" [showCurrentPageReport]="false"></p-paginator>

      <div class="empty-state" *ngIf="artists.length === 0 && !loading">
        <i class="pi pi-users"></i>
        <p>No artists found</p>
        <p-button label="Add First Artist" icon="pi pi-plus" (onClick)="openNewArtist()" styleClass="p-button-outlined"></p-button>
      </div>

      <div class="loading-state" *ngIf="loading">
        <p-progressSpinner strokeWidth="4" [style]="{width: '40px', height: '40px'}"></p-progressSpinner>
        <p>Loading artists...</p>
      </div>
    </div>

    <!-- Artist Details Panel -->
    <div class="details-panel">
      <div *ngIf="selectedArtist?.id" class="artist-details">
        <div class="details-header">
          <div class="artist-profile">
            <div class="profile-avatar">
              <img *ngIf="selectedArtist.imageUrl" [src]="selectedArtist.imageUrl" [alt]="selectedArtist.name" />
              <i *ngIf="!selectedArtist.imageUrl" class="pi pi-user"></i>
            </div>
            <div class="profile-info">
              <h2>
                {{ selectedArtist.name }}
                <i *ngIf="selectedArtist.verified" class="pi pi-verified text-primary" pTooltip="Verified Artist"></i>
              </h2>
              <div class="profile-meta">
                <p-tag *ngIf="selectedArtist.genre" [value]="selectedArtist.genre" severity="info"></p-tag>
                <span *ngIf="selectedArtist.country">{{ selectedArtist.country }}</span>
                <p-tag [value]="selectedArtist.active ? 'Active' : 'Inactive'"
                       [severity]="selectedArtist.active ? 'success' : 'danger'"></p-tag>
              </div>
            </div>
          </div>
          <div class="header-actions">
            <p-button icon="pi pi-pencil" label="Edit" (onClick)="editArtist(selectedArtist)" styleClass="p-button-outlined"></p-button>
            <p-button [icon]="selectedArtist.verified ? 'pi pi-times-circle' : 'pi pi-check-circle'"
                      [label]="selectedArtist.verified ? 'Unverify' : 'Verify'"
                      (onClick)="toggleVerification(selectedArtist)"
                      [styleClass]="selectedArtist.verified ? 'p-button-warning' : 'p-button-success'"></p-button>
          </div>
        </div>

        <div class="details-body">
          <!-- Stats -->
          <div class="stats-section">
            <div class="stat-card">
              <i class="pi pi-users"></i>
              <div class="stat-value">{{ formatNumber(selectedArtist.monthlyListeners) }}</div>
              <div class="stat-label">Monthly Listeners</div>
            </div>
          </div>

          <!-- Bio -->
          <div class="bio-section" *ngIf="selectedArtist.bio">
            <h4>Biography</h4>
            <p>{{ selectedArtist.bio }}</p>
          </div>

          <!-- Social Links -->
          <div class="social-section">
            <h4>Social Links</h4>
            <div class="social-links">
              <a *ngIf="selectedArtist.spotifyUrl" [href]="selectedArtist.spotifyUrl" target="_blank" class="social-link spotify">
                <i class="pi pi-spotify"></i> Spotify
              </a>
              <a *ngIf="selectedArtist.youtubeUrl" [href]="selectedArtist.youtubeUrl" target="_blank" class="social-link youtube">
                <i class="pi pi-youtube"></i> YouTube
              </a>
              <a *ngIf="selectedArtist.instagramUrl" [href]="selectedArtist.instagramUrl" target="_blank" class="social-link instagram">
                <i class="pi pi-instagram"></i> Instagram
              </a>
              <a *ngIf="selectedArtist.websiteUrl" [href]="selectedArtist.websiteUrl" target="_blank" class="social-link website">
                <i class="pi pi-globe"></i> Website
              </a>
              <span *ngIf="!selectedArtist.spotifyUrl && !selectedArtist.youtubeUrl && !selectedArtist.instagramUrl && !selectedArtist.websiteUrl"
                    class="text-secondary">No social links added</span>
            </div>
          </div>

          <!-- Songs Section -->
          <div class="songs-section">
            <div class="songs-header">
              <h4><i class="pi pi-music mr-2"></i>Songs by this Artist</h4>
              <span class="songs-count">{{ artistSongs.length }} track(s)</span>
            </div>

            <div *ngIf="loadingArtistSongs" class="loading-songs">
              <p-progressSpinner strokeWidth="4" [style]="{width: '30px', height: '30px'}"></p-progressSpinner>
              <span>Loading songs...</span>
            </div>

            <div *ngIf="!loadingArtistSongs && artistSongs.length === 0" class="empty-songs">
              <i class="pi pi-music"></i>
              <p>No songs by this artist yet</p>
              <small>Add songs from the Media Upload page</small>
            </div>

            <div *ngIf="!loadingArtistSongs && artistSongs.length > 0" class="songs-list">
              <div *ngFor="let song of artistSongs; let i = index" class="song-row">
                <div class="song-number">{{ i + 1 }}</div>
                <div class="song-info">
                  <img *ngIf="song.thumbnailUrl" [src]="song.thumbnailUrl" class="song-thumb" alt="thumb">
                  <div *ngIf="!song.thumbnailUrl" class="song-thumb-placeholder">
                    <i class="pi pi-music"></i>
                  </div>
                  <div class="song-details">
                    <span class="song-title" [pTooltip]="song.title" tooltipPosition="top">{{ song.title }}</span>
                    <span class="song-album" *ngIf="song.album">{{ song.album.name }}</span>
                  </div>
                </div>
                <div class="song-type">
                  <p-tag [value]="song.mediaType" [severity]="song.mediaType === 'VIDEO' ? 'primary' : 'info'" styleClass="song-type-tag"></p-tag>
                </div>
                <div class="song-duration" *ngIf="song.durationSeconds">
                  {{ song.durationSeconds | number:'1.0-0' }}s
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="!selectedArtist?.id" class="no-selection">
        <i class="pi pi-arrow-left"></i>
        <p>Select an artist to view details</p>
      </div>
    </div>
  </div>
</div>

<!-- Artist Edit/Create Dialog -->
<p-dialog [(visible)]="artistDialog" [style]="{width: '700px'}"
          [header]="isNewArtist ? 'Add New Artist' : 'Edit Artist'"
          [modal]="true" class="p-fluid">
    <ng-template pTemplate="content">
        <div class="grid">
            <!-- Basic Info -->
            <div class="col-12">
                <h4 class="mt-0 mb-3 text-primary">Basic Information</h4>
            </div>
            <div class="col-12 md:col-6">
                <label for="name" class="block text-sm font-medium mb-2">Artist Name *</label>
                <input id="name" type="text" pInputText [(ngModel)]="selectedArtist.name" class="w-full" />
            </div>
            <div class="col-12 md:col-6">
                <label for="genre" class="block text-sm font-medium mb-2">Genre</label>
                <p-dropdown id="genre" [options]="genres" [(ngModel)]="selectedArtist.genre"
                            placeholder="Select Genre" [showClear]="true" styleClass="w-full"></p-dropdown>
            </div>
            <div class="col-12 md:col-6">
                <label for="country" class="block text-sm font-medium mb-2">Country</label>
                <p-dropdown id="country" [options]="countries" [(ngModel)]="selectedArtist.country"
                            placeholder="Select Country" [showClear]="true" styleClass="w-full"></p-dropdown>
            </div>
            <div class="col-12 md:col-6">
                <label for="monthlyListeners" class="block text-sm font-medium mb-2">Monthly Listeners</label>
                <input id="monthlyListeners" type="number" pInputText [(ngModel)]="selectedArtist.monthlyListeners" class="w-full" />
            </div>
            <div class="col-12">
                <label for="bio" class="block text-sm font-medium mb-2">Biography</label>
                <textarea id="bio" pInputTextarea [(ngModel)]="selectedArtist.bio" rows="3" class="w-full"></textarea>
            </div>

            <!-- Image & Links -->
            <div class="col-12 mt-3">
                <h4 class="mt-0 mb-3 text-primary">Artist Image</h4>
            </div>
            <div class="col-12">
                <label class="block text-sm font-medium mb-2">Upload Image</label>
                <div class="image-upload-section">
                    <div class="image-preview" *ngIf="imagePreviewUrl">
                        <img [src]="imagePreviewUrl" alt="Artist preview" />
                        <button pButton icon="pi pi-times" class="p-button-rounded p-button-danger p-button-sm remove-btn"
                                (click)="clearImage()" pTooltip="Remove image"></button>
                    </div>
                    <div class="image-upload-controls" *ngIf="!imagePreviewUrl">
                        <p-fileUpload mode="basic" name="image" (onSelect)="onImageSelect($event)"
                            accept="image/*" chooseLabel="Choose Image" [auto]="false"></p-fileUpload>
                        <small class="text-secondary mt-2 block">Image will be saved as "artists/{{selectedArtist.name | lowercase}}.jpg"</small>
                    </div>
                </div>
            </div>

            <!-- Social Links -->
            <div class="col-12 mt-3">
                <h4 class="mt-0 mb-3 text-primary">Social Links</h4>
            </div>
            <div class="col-12 md:col-6">
                <label for="spotifyUrl" class="block text-sm font-medium mb-2">
                    <i class="pi pi-spotify mr-1"></i> Spotify URL
                </label>
                <input id="spotifyUrl" type="text" pInputText [(ngModel)]="selectedArtist.spotifyUrl" class="w-full" />
            </div>
            <div class="col-12 md:col-6">
                <label for="youtubeUrl" class="block text-sm font-medium mb-2">
                    <i class="pi pi-youtube mr-1"></i> YouTube URL
                </label>
                <input id="youtubeUrl" type="text" pInputText [(ngModel)]="selectedArtist.youtubeUrl" class="w-full" />
            </div>
            <div class="col-12 md:col-6">
                <label for="instagramUrl" class="block text-sm font-medium mb-2">
                    <i class="pi pi-instagram mr-1"></i> Instagram URL
                </label>
                <input id="instagramUrl" type="text" pInputText [(ngModel)]="selectedArtist.instagramUrl" class="w-full" />
            </div>
            <div class="col-12 md:col-6">
                <label for="websiteUrl" class="block text-sm font-medium mb-2">
                    <i class="pi pi-globe mr-1"></i> Website URL
                </label>
                <input id="websiteUrl" type="text" pInputText [(ngModel)]="selectedArtist.websiteUrl" class="w-full" />
            </div>

            <!-- Status -->
            <div class="col-12 mt-3">
                <h4 class="mt-0 mb-3 text-primary">Status</h4>
            </div>
            <div class="col-12 md:col-6 flex align-items-center">
                <p-checkbox [(ngModel)]="selectedArtist.verified" [binary]="true" inputId="verified"></p-checkbox>
                <label for="verified" class="ml-2">Verified Artist</label>
            </div>
            <div class="col-12 md:col-6 flex align-items-center">
                <p-checkbox [(ngModel)]="selectedArtist.active" [binary]="true" inputId="active"></p-checkbox>
                <label for="active" class="ml-2">Active</label>
            </div>
        </div>
    </ng-template>

    <ng-template pTemplate="footer">
        <button pButton label="Cancel" icon="pi pi-times" class="p-button-text" (click)="hideDialog()" [disabled]="uploadingImage"></button>
        <button pButton [label]="uploadingImage ? 'Uploading...' : 'Save'" icon="pi pi-check" class="p-button-primary"
                (click)="saveArtist()" [loading]="uploadingImage"></button>
    </ng-template>
</p-dialog>

<!-- Delete Confirmation Dialog -->
<p-dialog [(visible)]="deleteDialog" header="Confirm Delete" [modal]="true" [style]="{width:'400px'}">
    <div class="flex align-items-center">
        <i class="pi pi-exclamation-triangle mr-3 text-warning" style="font-size: 2rem"></i>
        <span>Are you sure you want to delete <b>{{selectedArtist.name}}</b>?</span>
    </div>
    <ng-template pTemplate="footer">
        <button pButton label="No" icon="pi pi-times" class="p-button-text" (click)="deleteDialog = false"></button>
        <button pButton label="Yes" icon="pi pi-check" class="p-button-danger" (click)="deleteArtist()"></button>
    </ng-template>
</p-dialog>

<p-toast></p-toast>
