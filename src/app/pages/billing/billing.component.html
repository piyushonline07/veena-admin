<div class="billing-container">
    <div class="header-section mb-4 flex justify-content-between align-items-center">
        <div>
            <h1>AWS Billing Dashboard</h1>
            <p class="text-secondary">Current month cost breakdown and trends</p>
        </div>
        <div class="flex align-items-center gap-3">
            <div class="flex align-items-center gap-2">
                <p-checkbox [(ngModel)]="autoRefresh" [binary]="true"
                    (onChange)="toggleAutoRefresh()" inputId="autoRefresh"></p-checkbox>
                <label for="autoRefresh" class="text-sm">Auto-refresh (1 min)</label>
            </div>
            <button pButton icon="pi pi-refresh" label="Refresh"
                class="p-button-outlined" (click)="refreshNow()" [loading]="loading"></button>
        </div>
    </div>

    <!-- Summary Cards -->
    <div class="grid mb-4">
        <div class="col-12 md:col-6 lg:col-3">
            <p-card styleClass="h-full">
                <div class="flex flex-column">
                    <span class="text-secondary text-sm mb-2">Current Month Total</span>
                    <span class="text-3xl font-bold text-primary">${{getTotalCost()}}</span>
                    <span class="text-xs text-secondary mt-1">USD</span>
                </div>
            </p-card>
        </div>
        <div class="col-12 md:col-6 lg:col-3">
            <p-card styleClass="h-full">
                <div class="flex flex-column">
                    <span class="text-secondary text-sm mb-2">Average Daily Cost</span>
                    <span class="text-3xl font-bold text-blue-500">${{getAverageDailyCost()}}</span>
                    <span class="text-xs text-secondary mt-1">per day</span>
                </div>
            </p-card>
        </div>
        <div class="col-12 md:col-6 lg:col-3">
            <p-card styleClass="h-full">
                <div class="flex flex-column">
                    <span class="text-secondary text-sm mb-2">Projected Monthly</span>
                    <span class="text-3xl font-bold text-orange-500">${{getProjectedMonthlyCost()}}</span>
                    <span class="text-xs text-secondary mt-1">estimated</span>
                </div>
            </p-card>
        </div>
        <div class="col-12 md:col-6 lg:col-3">
            <p-card styleClass="h-full">
                <div class="flex flex-column">
                    <span class="text-secondary text-sm mb-2">Top Service</span>
                    <span class="text-xl font-bold text-purple-500">{{getTopService()}}</span>
                    <span class="text-xs text-secondary mt-1">highest cost</span>
                </div>
            </p-card>
        </div>
    </div>

    <!-- Charts -->
    <div class="grid">
        <!-- Daily Cost Bar Chart -->
        <div class="col-12 lg:col-6">
            <p-card header="Daily Cost Breakdown">
                <div class="chart-container" style="height: 300px;">
                    <p-chart *ngIf="dailyChartData" type="bar" [data]="dailyChartData"
                        [options]="chartOptions" [style]="{'height': '100%', 'width': '100%'}"></p-chart>
                    <div *ngIf="!dailyChartData && !loading" class="flex align-items-center justify-content-center h-full">
                        <span class="text-secondary">No data available</span>
                    </div>
                    <div *ngIf="loading" class="flex align-items-center justify-content-center h-full">
                        <p-progressSpinner [style]="{width: '50px', height: '50px'}"></p-progressSpinner>
                    </div>
                </div>
            </p-card>
        </div>

        <!-- Cumulative Cost Line Chart -->
        <div class="col-12 lg:col-6">
            <p-card header="Cumulative Cost Trend">
                <div class="chart-container" style="height: 300px;">
                    <p-chart *ngIf="cumulativeChartData" type="line" [data]="cumulativeChartData"
                        [options]="chartOptions" [style]="{'height': '100%', 'width': '100%'}"></p-chart>
                    <div *ngIf="!cumulativeChartData && !loading" class="flex align-items-center justify-content-center h-full">
                        <span class="text-secondary">No data available</span>
                    </div>
                    <div *ngIf="loading" class="flex align-items-center justify-content-center h-full">
                        <p-progressSpinner [style]="{width: '50px', height: '50px'}"></p-progressSpinner>
                    </div>
                </div>
            </p-card>
        </div>

        <!-- Cost by Service Pie Chart -->
        <div class="col-12 lg:col-6">
            <p-card header="Cost by AWS Service">
                <div class="chart-container" style="height: 300px;">
                    <p-chart *ngIf="serviceChartData" type="doughnut" [data]="serviceChartData"
                        [options]="pieChartOptions" [style]="{'height': '100%', 'width': '100%'}"></p-chart>
                    <div *ngIf="!serviceChartData && !loading" class="flex align-items-center justify-content-center h-full">
                        <span class="text-secondary">No data available</span>
                    </div>
                    <div *ngIf="loading" class="flex align-items-center justify-content-center h-full">
                        <p-progressSpinner [style]="{width: '50px', height: '50px'}"></p-progressSpinner>
                    </div>
                </div>
            </p-card>
        </div>

        <!-- Service Cost Table -->
        <div class="col-12 lg:col-6">
            <p-card header="Service Cost Details">
                <p-table [value]="serviceCosts" [loading]="loading" styleClass="p-datatable-sm">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>Service</th>
                            <th class="text-right">Cost (USD)</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-service>
                        <tr>
                            <td>{{shortenServiceName(service.serviceName)}}</td>
                            <td class="text-right font-bold">${{service.amount.toFixed(2)}}</td>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="2" class="text-center text-secondary">No service cost data available</td>
                        </tr>
                    </ng-template>
                </p-table>
            </p-card>
        </div>
    </div>

    <!-- Last Updated -->
    <div class="mt-3 text-right">
        <small class="text-secondary" *ngIf="lastUpdated">
            Last updated: {{lastUpdated | date:'medium'}}
        </small>
    </div>
</div>

<p-toast></p-toast>
